<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chaud Devant - Showcase</title>
    <style>
        :root {
            --bg-color: #1a1a1a;
            --pin-size: min(85vw, 500px); /* Responsive mais max 500px */
        }

        body, html {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: white;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            overflow: hidden; /* Pour gérer le scroll nous-mêmes */
            height: 100%;
        }

        /* Conteneur principal style "TikTok" */
        #feed {
            height: 100%;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
            scroll-behavior: smooth;
        }

        /* Chaque "page" de vidéo */
        .video-slide {
            height: 100%;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            scroll-snap-align: center;
            position: relative;
        }

        /* --- LE STYLE MACARON BOMBÉ --- */
        .macaron-wrapper {
            width: var(--pin-size);
            height: var(--pin-size);
            position: relative;
            border-radius: 50%;
            
            /* L'ombre portée qui donne la distance avec le fond */
            box-shadow: 0 20px 50px rgba(0,0,0,0.6);
            
            /* Animation d'entrée */
            opacity: 0;
            transform: scale(0.8);
            transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .video-slide.active .macaron-wrapper {
            opacity: 1;
            transform: scale(1);
        }

        /* Le conteneur rond physique */
        .macaron-body {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            overflow: hidden;
            position: relative;
            border: 6px solid #f0f0f0; /* Bordure blanche type "plastique" */
            box-sizing: border-box;
            background: #000;
        }

        /* La vidéo */
        .macaron-video {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Remplit tout le rond */
            display: block;
        }

        /* L'effet de brillance "Dome" par dessus la vidéo */
        .macaron-shine {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            border-radius: 50%;
            pointer-events: none; /* Laisse passer les clics */
            
            /* Reflet complexe pour l'effet bombé */
            background: 
                radial-gradient(circle at 30% 25%, rgba(255,255,255,0.25) 0%, rgba(255,255,255,0) 25%), /* Gros spot */
                radial-gradient(circle at 50% 10%, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 60%), /* Lumière haut */
                linear-gradient(180deg, rgba(255,255,255,0.15) 0%, rgba(255,255,255,0) 40%, rgba(0,0,0,0.2) 100%); /* Volume global */
            
            box-shadow: inset 0 0 20px rgba(0,0,0,0.5); /* Ombre interne sur les bords */
            z-index: 2;
        }

        /* Métadonnées (Titre) flottant en dessous */
        .meta-info {
            position: absolute;
            bottom: 10%;
            text-align: center;
            width: 100%;
            opacity: 0.8;
            pointer-events: none;
            text-shadow: 0 2px 4px rgba(0,0,0,0.8);
        }
        
        .meta-title {
            font-size: 1.2rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Bouton Play/Pause centré (invisible si playing) */
        .play-overlay {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4rem;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 5;
            text-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }
        .paused .play-overlay {
            opacity: 1;
        }

    </style>
</head>
<body>

<div id="feed">
    <!-- Les vidéos seront injectées ici -->
</div>

<script>
    const feed = document.getElementById('feed');
    let videosData = [];

    // Fonction pour créer une slide vidéo
    function createSlide(videoInfo) {
        const slide = document.createElement('div');
        slide.className = 'video-slide';
        
        // On cherche la meilleure URL (1x1 priorité absolu pour le rond, sinon 9x16)
        let videoUrl = videoInfo.bunny_urls['1x1'];
        if (!videoUrl) videoUrl = videoInfo.bunny_urls['9x16'];
        if (!videoUrl) videoUrl = videoInfo.bunny_urls['16x9']; // Fallback ultime

        if (!videoUrl) return null;

        slide.innerHTML = `
            <div class="macaron-wrapper">
                <div class="macaron-body">
                    <video class="macaron-video" loop playsinline muted>
                        <source src="${videoUrl}" type="video/mp4">
                    </video>
                    <div class="macaron-shine"></div>
                    <div class="play-overlay">▶</div>
                </div>
            </div>
            <div class="meta-info">
                <div class="meta-title">${videoInfo.id.replace(/_/g, ' ')}</div>
            </div>
        `;

        // Gestion du clic pour play/pause + son
        const wrapper = slide.querySelector('.macaron-wrapper');
        const video = slide.querySelector('video');
        
        wrapper.addEventListener('click', () => {
             if (video.paused) {
                 video.muted = false; // On active le son au clic utilisateur
                 video.play();
                 wrapper.classList.remove('paused');
             } else {
                 video.pause();
                 wrapper.classList.add('paused');
             }
        });

        return slide;
    }

    // Chargement des données
    async function init() {
        try {
            const response = await fetch('showcase.json');
            videosData = await response.json();
            
            // On inverse pour avoir les plus récents en haut
            videosData.reverse().forEach(vid => {
                const el = createSlide(vid);
                if (el) feed.appendChild(el);
            });

            setupObserver();

        } catch (e) {
            console.error("Erreur chargement showcase:", e);
            feed.innerHTML = "<h2 style='text-align:center'>Aucune vidéo trouvée...</h2>";
        }
    }

    // Observer pour lancer la vidéo quand elle arrive au centre
    function setupObserver() {
        const options = {
            root: feed,
            threshold: 0.6 // Doit être 60% visible pour s'activer
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                const video = entry.target.querySelector('video');
                if (entry.isIntersecting) {
                    entry.target.classList.add('active');
                    // Tentative d'autoplay (souvent muet requis par les navigateurs)
                    video.play().catch(() => {
                        // Si autoplay bloqué, on montre que c'est en pause
                        entry.target.querySelector('.macaron-wrapper').classList.add('paused');
                    });
                } else {
                    entry.target.classList.remove('active');
                    video.pause();
                    video.currentTime = 0; // Reset pour loop propre
                }
            });
        }, options);

        document.querySelectorAll('.video-slide').forEach(slide => {
            observer.observe(slide);
        });
    }

    init();
</script>

</body>
</html>
